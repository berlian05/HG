#!/bin/bash

echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã..."

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
echo "‚èπÔ∏è  –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã..."
pkill -f "uvicorn app.main:app"
pkill -f "python bot.py"
pkill -f "next dev"

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
sleep 2

# –ó–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –±—ç–∫–µ–Ω–¥..."
cd /root/HG/backend
source venv/bin/activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload &
BACKEND_PID=$!
echo "‚úÖ –ë—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω (PID: $BACKEND_PID)"

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ –±—ç–∫–µ–Ω–¥–∞
sleep 3

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
echo "ü§ñ –ó–∞–ø—É—Å–∫–∞–µ–º Telegram –±–æ—Ç–∞..."
cd /root/HG/backend/bot
source venv/bin/activate
python bot.py &
BOT_PID=$!
echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω (PID: $BOT_PID)"

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
sleep 2

# –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo "üåê –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥..."
cd /root/HG
npm run dev &
FRONTEND_PID=$!
echo "‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω (PID: $FRONTEND_PID)"

echo ""
echo "üéâ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã!"
echo "üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
echo "   –ë—ç–∫–µ–Ω–¥: $BACKEND_PID"
echo "   –ë–æ—Ç: $BOT_PID"
echo "   –§—Ä–æ–Ω—Ç–µ–Ω–¥: $FRONTEND_PID"
echo ""
echo "üîó –°—Å—ã–ª–∫–∏:"
echo "   –§—Ä–æ–Ω—Ç–µ–Ω–¥: http://localhost:3000"
echo "   –ë—ç–∫–µ–Ω–¥ API: http://localhost:8000"
echo "   Health check: http://localhost:8000/health"
echo ""
echo "üí° –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: pkill -f 'uvicorn\|bot.py\|next dev'" 